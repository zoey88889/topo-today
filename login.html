<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <title>TOPO Today | ç™»å½• / æ³¨å†Œ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      font-family: sans-serif;
      background: #f4f4f4;
      margin: 0;
      padding: 0;
    }
    .container {
      max-width: 400px;
      margin: 4rem auto;
      background: #fff;
      padding: 2rem;
      border-radius: 12px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }
    input, button {
      width: 100%;
      padding: 1rem;
      margin: 0.5rem 0;
      font-size: 1rem;
      border-radius: 8px;
      border: 1px solid #ccc;
    }
    button {
      background: black;
      color: white;
      cursor: pointer;
    }
    button:hover {
      background: #333;
    }
    .msg {
      margin-top: 1rem;
      text-align: center;
      font-size: 0.95rem;
      color: #666;
    }
  </style>
<link rel="privacy-policy" href="/privacy.html" />
</head>
<body>
  <div class="container">
    <h2>æ¬¢è¿ç™»å½• TOPO Today</h2>

    <!-- ğŸ“§ é‚®ç®± + å¯†ç ç™»å½• -->
    <input type="email" id="email" placeholder="é‚®ç®±åœ°å€" required />
    <input type="password" id="password" placeholder="å¯†ç ï¼ˆè‡³å°‘6ä½ï¼‰" required />
    <button id="loginBtn">ğŸ“© æ³¨å†Œ / ç™»å½•</button>

    <!-- ğŸ” Google ç™»å½• -->
    <button onclick="loginWithGoogle()">ğŸ” ä½¿ç”¨ Google ç™»å½•</button>

    <!-- âœ¨ Magic Link ç™»å½• -->
    <button onclick="loginWithMagic()">âœ¨ é­”æ³•é“¾æ¥ç™»å½•</button>

    <div class="msg" id="msg"></div>
  </div>

  <!-- 1ï¸âƒ£ SDK -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>

  <!-- 2ï¸âƒ£ åˆå§‹åŒ– supabase -->
  <script>
    window.supabase = window.supabase.createClient(
      'https://hmbpfxjszahfibfhezft.supabase.co',
      'sb-publishable_PcGwCM6lAGzlGiwXNmRQPA_ahffzC-V'
    );
  </script>

  <!-- 3ï¸âƒ£ ç™»å½•é€»è¾‘ -->
  <script>
    const msgBox = document.getElementById("msg");

    // ğŸ“§ æ³¨å†Œ + ç™»å½•ï¼ˆå¸¦éªŒè¯é‚®ä»¶ï¼‰
    document.getElementById("loginBtn").addEventListener("click", async () => {
      const email = document.getElementById("email").value.trim();
      const password = document.getElementById("password").value.trim();

      if (!email || !password) {
        msgBox.textContent = "è¯·è¾“å…¥é‚®ç®±å’Œå¯†ç ";
        return;
      }

      try {
        const { error: signupError } = await window.supabase.auth.signUp({ email, password });

        if (!signupError) {
          msgBox.textContent = "âœ… æ³¨å†ŒæˆåŠŸï¼è¯·å‰å¾€é‚®ç®±ç¡®è®¤";
        } else {
          const { error: loginError } = await window.supabase.auth.signInWithPassword({ email, password });

          if (!loginError) {
            msgBox.textContent = "ğŸ‰ ç™»å½•æˆåŠŸï¼Œæ­£åœ¨è·³è½¬...";
            setTimeout(() => window.location.href = "index.html", 1500);
          } else {
            msgBox.textContent = "âŒ ç™»å½•å¤±è´¥ï¼š" + loginError.message;
          }
        }
      } catch (err) {
        msgBox.textContent = "âŒ ç³»ç»Ÿé”™è¯¯ï¼š" + err.message;
      }
    });

    // âœ¨ Magic Link ç™»å½•
    async function loginWithMagic() {
      const email = document.getElementById("email").value.trim();
      if (!email) {
        msgBox.textContent = "è¯·è¾“å…¥é‚®ç®±åå†ç‚¹é­”æ³•é“¾æ¥";
        return;
      }

      const { error } = await window.supabase.auth.signInWithOtp({
        email,
        options: {
          emailRedirectTo: 'https://topoto.netlify.app/index.html' // ç™»å½•åè·³è½¬
        }
      });

      if (error) {
        msgBox.textContent = "âŒ é­”æ³•é“¾æ¥å‘é€å¤±è´¥ï¼š" + error.message;
      } else {
        msgBox.textContent = "ğŸ“¨ é­”æ³•é“¾æ¥å·²å‘é€ï¼Œè¯·æ£€æŸ¥é‚®ç®±ï¼";
      }
    }

    // ğŸ” Google ç™»å½•
    async function loginWithGoogle() {
      const { error } = await window.supabase.auth.signInWithOAuth({
        provider: 'google',
        options: {
          redirectTo: 'https://topoto.netlify.app/index.html'
        }
      });

      if (error) {
        msgBox.textContent = "âŒ Google ç™»å½•å¤±è´¥ï¼š" + error.message;
      }
    }
  </script>










<div id="footer"></div>
<script>
  fetch("/components/footer.html")
    .then(res => res.text())
    .then(html => {
      document.getElementById("footer").innerHTML = html;
    });
</script>
</body>
</html>
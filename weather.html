 <!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ğŸŒ¤ï¸ å¤©æ°”é¢‘é“ | TOPO TODAY</title>
  <link rel="stylesheet" href="styles/styles.css" />
</head>

<body>
  <header class="hero">
    <h1>ğŸŒ¤ï¸ å¤©æ°”é¢‘é“</h1>
    <p>æ¯æ—¥ AI æ’·å–å¤©æ°”æé†’ + å‡ºè¡Œå»ºè®®</p >
  </header>

  <!-- æ¬¢è¿åŒº + ç™»å½•æç¤º -->
  <div id="welcome" style="text-align:center; margin-top: 1rem;"></div>

  <!-- æŠ•ç¨¿è¡¨å•ï¼ˆå¦‚å…è®¸å‘å¸ƒï¼‰ -->
  <section class="modules">
    <form id="postForm" enctype="multipart/form-data" style="background:#fff; padding:2rem; border-radius:8px; max-width:600px; margin: 0 auto;">
      <input type="text" id="title" placeholder="è¯·è¾“å…¥æ ‡é¢˜ï¼Œå¦‚ï¼šä»Šæ—¥å¤§é›ªï¼Œè¯·æ³¨æ„å‡ºè¡Œ" required />
      <input type="file" id="imageUpload" accept="image/*" multiple />
      <textarea id="content" rows="5" placeholder="å†™ä¸‹å¤©æ°”æƒ…å†µã€å»ºè®®äº‹é¡¹ã€å‡ºè¡Œæé†’â€¦" required></textarea>
      <button type="submit" style="margin-top: 1rem;">âœ¨ å‘å¸ƒå¤©æ°”æé†’</button>
    </form>
  </section>

  <!-- å±•ç¤ºåŒºåŸŸ -->
  <div id="postContainer" style="margin-top: 2rem;"></div>

  <!-- è‡ªåŠ¨è¯†åˆ«å½“å‰åˆ†ç±» -->
  <script>
    window.TOPO_CATEGORY = "weather";
  </script>
  <script>
  async function fetchRSSFeed() {
    const proxy = "https://api.allorigins.win/get?url=";
    const feedUrl = encodeURIComponent("https://w1.weather.gov/xml/current_obs/KNYC.rss");

    try {
      const res = await fetch(proxy + feedUrl);
      const data = await res.json();

      const parser = new DOMParser();
      const xml = parser.parseFromString(data.contents, "text/xml");
      const items = xml.querySelectorAll("item");

      const container = document.getElementById("rssContainer");
      container.innerHTML = "";

      items.forEach((item, index) => {
        if (index >= 3) return;

        const title = item.querySelector("title").textContent;
        const desc = item.querySelector("description").textContent;
        const link = item.querySelector("link").textContent;

        const card = document.createElement("div");
        card.className = "card";
        card.style = `
          background: #fff9db;
          border-left: 6px solid #ffc107;
          padding: 1rem;
          margin-bottom: 1rem;
          border-radius: 8px;
        `;

        card.innerHTML = `
          <h3 style="margin-bottom:0.5rem;">ğŸŒ¤ï¸ ${title}</h3>
          <p style="font-size:0.9rem;">${desc}</p >
          <a href="${link}" target="_blank" style="font-size:0.85rem; color: #2196f3;">ğŸ”— æŸ¥çœ‹è¯¦æƒ…</a >
        `;

        container.appendChild(card);
      });
    } catch (err) {
      console.error("âŒ RSS åŠ è½½å¤±è´¥ï¼š", err);
      document.getElementById("rssContainer").innerHTML = `<p style="color:red;">æ— æ³•åŠ è½½å¤©æ°” RSS æ•°æ®ï¼Œè¯·ç¨åå†è¯•ã€‚</p >`;
    }
  }

  fetchRSSFeed();
</script>

  <!-- è„šæœ¬åŠ è½½ -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <script src="scripts/supabase.js"></script>
  <script src="scripts/post-upload.js"></script>
  <script src="scripts/post-display.js"></script>

  <!-- é¡µè„š -->
  <div id="footer"></div>
  <script>
    fetch("/components/footer.html")
      .then(res => res.text())
      .then(html => {
        document.getElementById("footer").innerHTML = html;
      });
  </script>
</body>
</html>